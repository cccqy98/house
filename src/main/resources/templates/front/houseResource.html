<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>枫城</title>
    <link rel="icon" href="resources/images/fengye1.ico"/>
    <script src="resources/js/jquery.js"></script>
    <script src="resources/vue/vue.js"></script>

    <script src="resources/antd/moment.js"></script>
    <script src="resources/antd/antd.min.js"></script>
    <script src="resources/antd/ant-design-vue.js"></script>
    <link href="resources/antd/antd.min.css" rel="stylesheet">
    <script src="resources/js/ele.js"></script>
    <link href="resources/css/ele.css" rel="stylesheet">
    <!--axios-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <style type="text/css">
        /*导航栏css*/
        a {
            /*font-size: 16px;*/
            text-decoration: none;
            color: black;
        }

        .el-menu-item {
            text-align: center;
        }

        a:hover {
            color: orange
        }

        /*图片展示css*/
        .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            margin-left: 100px;
        }

    </style>
    <style>
        #components-layout-demo-fixed .logo {
            width: 120px;
            height: 20px;
            /*background: rgba(255, 255, 255, .1);*/
            margin: 16px 24px 16px 0;
            float: left;
        }

        .form {
            margin-left: 300px;
        }

        .form input {
            border: none;
        }

        .tit {
            line-height: 1;
            text-align: center;
        }

        .tit .title {
            font-weight: bold;
            color: #000000;
            font-size: 33px;
        }

        #components-layout-demo-fixed .logo img {
            width: 120px;
            height: 95px;
            margin-top: -35px;
        }

        .lr,
        #cus {
            padding-left: 0;
            padding-right: 0;
            float: right;
        }

        #ulinfo li {
            list-style: none;
            float: left;
            padding: 5px;
            background-color: lightgray;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 13px;
        }

        .zf {
            margin-bottom: 10px;
            margin-top: 10px;
        }

        .zf span {
            margin-right: 15px;
        }

        .zf a {
            font-size: 20px;
            font-weight: bold;
        }

        .zf img {
            border-radius: 10px;
            width: 250px;
            height: 180px;
            margin-left: 20px;
        }

        .ant-list-item-meta-title {
            margin-bottom: 30px;
        }

        .ant-list-item-meta-content {
            margin-left: 30px;
        }

        .ant-list-item-meta-description {
            font-size: 15px;
        }

        .ant-list-item-meta-description span {
            font-size: 14px;
            font-weight: bold;
        }

        .ant-list-item-meta-description p {
            margin-top: 20px;
            font-size: 14px;
        }

        #price {
            color: red;
            font-size: 26px;
            float: right;
        }

        /*#backImg{*/
        /*    background: url(static/) no-repeat center;*/
        /*}*/
    </style>
</head>

<body id="backImg">
<div id="house">
    <a-layout id="components-layout-demo-fixed">
        <!--导航栏-->
        <a-layout-header :style="{ position: 'fixed', zIndex: 1, width: '100%' }" style="background: white">
            <el-header>
                <el-row>
                    <el-menu style="border-radius: 4px;width: 106%;margin-left: -44px;margin-top: 5px"
                             class="el-menu-demo"
                             mode="horizontal"
                             background-color="#EBEEF5"
                             text-color="#fff"
                             active-text-color="#ffd04b">
                        <el-col :span="2" :offset="1">
                            <el-menu-item index="0">
                                <a href="main.html"><img src="resources/images/log.png" width="106" height="60"></a>
                            </el-menu-item>
                        </el-col>
                        <el-col :span="2">
                            <el-menu-item index="1"><a href="main.html">首页</a></el-menu-item>
                        </el-col>
                        <el-col :span="2">
                            <el-menu-item index="2"><a href="houselist.html">我要租房</a></el-menu-item>
                        </el-col>
                        <el-col :span="2">
                            <el-menu-item index="3"><a href="houseResource.html">发布房源</a></el-menu-item>
                        </el-col>
                        <el-col :span="2">
                            <el-menu-item index="4"><a href="main.html#fangxun">房讯</a></el-menu-item>
                        </el-col>
                        <el-col :span="2" :offset="10" v-if="imageUrl!=null">
                            <el-menu-item index="5">
                                <el-dropdown>
                            <span class="el-dropdown-link">
                                <el-avatar shape="circle" :size="45" :src="imageUrl"></el-avatar>
                             </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item><a href="userInfo.html" style="color: black;">个人中心</a>
                                        </el-dropdown-item>
                                        <el-dropdown-item><a @click="killCusSession()" style="color: black;">注销</a>
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-menu-item>
                        </el-col>
                        <el-col :span="1" :offset="10" v-if="imageUrl==null">
                            <el-menu-item index="6">
                                <a href="login.html">登录</a>
                            </el-menu-item>
                        </el-col>
                        <el-col :span="1" v-if="imageUrl==null">
                            <el-menu-item index="7">
                                <a href="register.html">注册</a>
                            </el-menu-item>
                        </el-col>
                    </el-menu>

                </el-row>
            </el-header>
        </a-layout-header>
        <!--内容区-->
        <a-layout-content style="background-color: #fff;padding: 0 100px; margin-top: 64px">
            <a-layout>
                <a-layout-content style="margin: 20px;">
                    <div class="tit">
                        <div class="title">发布房源</div>
                    </div>
                </a-layout-content>
                <a-layout-content style="background-color: #fff">
                    <div class="zf">
                        <h3 style="display: inline;margin-left: 20px">选择您所在的城市
                            <img src="resources/images/localtion.png" style="width: 25px;height: 25px;"/>
                            <h3 style="color: #2f54eb;display: inline">{{form.uh_urban}}</h3>
                        </h3>
                    </div>
                </a-layout-content>
                <a-layout>
                    <a-layout-content style="background-color: #fff;padding-right: 100px;">
                        <div class="form">
                            <el-form ref="form" :rules="rules" :model="form" label-width="80px" style="">
                                <el-form-item prop="uh_urban">
                                    <span style="color: #101d37;font: '微软雅黑';font-weight: bold;">城市&nbsp;&nbsp;</span>
                                    <el-select v-model="form.uh_urban" @change="urbanStreet" placeholder="请选择地区" id="address">
                                        <el-option label="郑州" value="1130121"></el-option>
                                        <el-option label="开封" value="1130122"></el-option>
                                        <el-option label="洛阳" value="1130123"></el-option>
                                        <el-option label="平顶山" value="1130124"></el-option>
                                        <el-option label="安阳" value="1130125"></el-option>
                                        <el-option label="鹤壁" value="1130126"></el-option>
                                        <el-option label="新乡" value="1130127"></el-option>
                                        <el-option label="焦作" value="1130128"></el-option>
                                        <el-option label="周口" value="1130129"></el-option>
                                        <el-option label="信阳" value="1130130"></el-option>
                                    </el-select>
                                </el-form-item>

                                <el-form-item prop="uh_street" :label-width="formLabelWidth">
                                    <span style="color: #101d37;font: '微软雅黑';font-weight: bold;">街道&nbsp;&nbsp;</span>
                                    <el-select v-model="form.uh_street" placeholder="请选择">
                                        <el-option
                                                v-for="item in options3"
                                                :key="item.code_state"
                                                :label="item.code_state"
                                                :value="item.code_number">
                                        </el-option>
                                    </el-select>
                                </el-form-item>

                                <el-form-item prop="uh_district">
                                    <span style="color: #101d37;font: '微软雅黑';font-weight: bold;">详细地址&nbsp;&nbsp;</span>
                                    <el-input  v-model="form.uh_district" style="width:220px"  placeholder="请填写小区"></el-input>
                                </el-form-item>

                                <el-form-item prop="uh_rent">
                                    <span style="color: #101d37;font: '微软雅黑';font-weight: bold;">租金&nbsp;&nbsp;</span>
                                    <el-input v-model.number="form.uh_rent" style="width: 200px;margin-top: 10px;" placeholder="请输入您期望的租金"></el-input>
                                </el-form-item>

                                <el-form-item prop="uh_name">
                                    <span style="color: #101d37;font: '微软雅黑';font-weight: bold;">称呼&nbsp;&nbsp;</span>
                                    <el-input v-model="form.uh_name" style="width: 200px;margin-top: 10px;" placeholder="我们应该怎样称呼您"></el-input>
                                </el-form-item>

                                <el-form-item prop="uh_phone">
                                    <span style="color: #101d37;font: '微软雅黑';font-weight: bold;">手机号码&nbsp;&nbsp;</span>
                                    <el-input v-model.number="form.uh_phone" style="width: 200px;margin-top: 10px;" placeholder="您的联系方式"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="onSubmit('form')">立即提交</el-button>
                                    <el-button @click="resetForm('form')">取消</el-button>
                                </el-form-item>
                            </el-form>
                        </div>
                    </a-layout-content>

                <a-layout-footer :style="{ textAlign: 'center' }">Copyright &copy; 2019.FengCheng.版权所有 |
                    本站内容版权属于原创，未经许可不得转载
                </a-layout-footer>
            </a-layout>
            </a-layout>
        </a-layout-content>
    </a-layout>
</div>
</body>
<script>

    var usevue = new Vue({
        el: "#house",
        data: {
            options3:[],
            value: '',
            imageUrl: null,
             ucard:null,
            form: {},
            setval: "",
            setval2: "",
            rules: {//校验
                uh_urban: [
                    {
                        required: true, //是否必填
                        message: '城市不能为空', //规则
                        trigger: 'blur',
                    },
                ],
                uh_street: [
                    {
                        required: true, //是否必填
                        message: '街道不能为空', //规则
                        trigger: 'blur',
                        //何事件触发
                    },
                ],
                uh_district: [
                    {
                        required: true, //是否必填
                        message: '详细地址不能为空', //规则
                        trigger: 'blur',
                        //何事件触发
                    },
                ],
                uh_rent: [
                    {
                        required: true, //是否必填
                        message: '租金不能为空', //规则
                        //何事件触发
                        trigger: 'blur',
                    },
                    {
                        type: 'number',
                        message: '租金必须是数字'
                    }
                ],
                uh_name: [
                    {
                        required: true, //是否必填
                        message: '称呼不能为空', //规则
                        trigger: 'blur', //何事件触发
                    },
                ],
                uh_phone: [
                    {
                        required: true, //是否必填
                        message: '手机号码不能为空', //规则
                        trigger: 'blur',//何事件触发,
                    },
                    {
                        type: 'number',
                        message: '手机号码必须是数字',
                    },
                    {
                        pattern: /^1[3|4|5|7|8][0-9]\d{8}$/,
                        message: '手机号格式错误'
                    }
                ],
            },
        },
        mounted: function () {
            var self = this;
            this.judgeCusLogin();

        },
        methods: {
            judgeCusLogin:function(){
                var self =this;
                axios.post('/loginReg/judgeCusLogin')
                    .then(function(response) {
                        if (response.data.code === 200) {
                            //头像显示
                            self.imageUrl = 'http://localhost:8080/loginReg/show?fileName=' + response.data.object.uphoto;
                            self.ucard=response.data.object.ucard
                        } else {
                            self.imageUrl = null;
                        }
                        self.yuyue();
                    })
            },

            yuyue: function () {
                var safe = this;
                if (this.imageUrl == null) {
                    this.$confirm('请先登录?', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(function () {
                        window.location.href = "login.html";
                    })
                } else if (this.ucard == null){
                    this.$confirm('请先实名认证?', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(function () {
                        window.location.href = "userInfo.html";
                    })
                }
            },






           /* open:function() {
                this.$alert('对不起老铁，请先登录谢谢。→_→', '提示', {
                    confirmButtonText: '确定',
                    callback: action => {
                        this.$message({
                            type: 'info',
                            message: `action: ${ action }`
                        });
                        window.location.href="login.html";
                    }
                });

            },*/
            /*获取街道*/
            urbanStreet: function() {
                var self=this;
                //加载街道
                axios.post('/getHouseCode',{'code_type':this.form.uh_urban})
                    .then(function (response) {
                        //JSON.stringify 把json对象装换为json字符串
                        console.log(JSON.stringify(response.data));
                        self.options3=response.data;
                    });

            },
            onSubmit: function (form) {//提交
                var self=this;
                this.$refs[form].validate((valid) => {
                    if (valid) {
                        axios.post('/addUser',self.form)
                            .then(function (response) {
                                //添加或者修改成功
                                if (response.data.code==200){
                                    self.$message({
                                        message: '恭喜你，提交成功成功',
                                        type: 'success'
                                    });
                                    self.resetForm(form);
                                }else {
                                    self.$message.error('错了哦，这是一条错误消息');
                                }
                            })
                    } else {
                        return false;
                    }
                });

            },
            resetForm(form) {//取消
                this.$refs[form].resetFields();
            },
            killCusSession() {
                axios.post('http://localhost:8080/loginReg/outUser')
                    .then(function (response) {
                        window.location.href = "main.html";
                    });
            }
        }
    });
    usevue.searchName();

</script>

</html>